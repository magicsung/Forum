
<!-- Category filter -->
<div class="dropdown">
  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
    Category filter
    <span class="caret"></span>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
    <li>
      <%= link_to "All", posts_path %>
    </li>
    <li role="separator" class="divider"></li>
    <% Category.all.map do |x| %>
      <li>
        <%= link_to x.name, posts_path( :where => "category_#{x.name}" ) %>
      </li>
    <% end %>
  </ul>
</div>


<!-- pages -->
<%= paginate @posts, :theme => 'twitter-bootstrap-3', :pagination_class => "pagination-sm" %>
<br>

<!-- List post -->
<table class="table table-striped table-hover">
  <tr class="info">
    <th>
      <%= link_to posts_path( :order => "category" ) do %> 
        Category <i class="caret"></i>
      <% end %>
    </th>
    <th><p>Title</p></th>
    <th>
      <%= link_to posts_path( :order => "comments" ) do %>
        Comments <i class="caret"></i>
      <% end %>
    </th>
    <th>
      comment_user
    </th>
    <th>
      <%= link_to posts_path( :order => "last_comment_time" ) do %>
        last_comment_time <i class="caret"></i>
      <% end %>
    </th>
    <th>
      <%= link_to posts_path( :order => "views" ) do %>
        Views <i class="caret"></i>
      <% end %>
    </th>
    <th><p>Created by</p></th>
    <th>
      <%= link_to posts_path( :order => "createtime" ) do %>
        Created_at <i class="caret"></i>
      <% end %>
    </th>
    <th></th>
  </tr>
  <% @posts.each do |p| %>
    <tr>
      <td><%= p.category.try(:name) %></td>
      <td><%= link_to p.title, post_path(p) %></td>
      <td><%= p.comcount %></td>
      <td>
        <!-- list comment user in this post -->
        <% b = p.comments.map do |x|  x.user.name  end %>
        <% b.uniq.map do |y| %>
          <%= y %>
        <% end %>
      </td>
      <td>
        <% if p.try(:last_comment_time) %>
          <%= p.try(:last_comment_time) %>
        <% else %>
          no comment yet
        <% end %>
      </td>
      <td><%= p.view %></td>
      <td>
        <!-- Link to user's profile -->
        <%= link_to profile_path(p.user.id) do %>
          <%= p.user.try(:name) %>
        <% end %>
      </td>
      <td><%= p.created_at %></td>
      <td>
        <%#= link_to "Show", post_path(p), :class => "btn btn-info" %>
        <!-- "有權限的"使用者登入才能編輯、刪除 -->
        <% if current_user %>
          <% if current_user.id == p.user_id %>
            <%= link_to "Edit", edit_post_path(p), :class => "btn btn-primary btn-xs" %>
            <%= link_to "Delete", post_path(p),:method => :delete, :data => { :confirm => "Are you sure?" }, :class => "btn btn-danger btn-xs" %>
          <% end %>
        <% end %>
      </td>
    </tr>
  <% end %>
</table>

<!-- pages -->
<%= paginate @posts, :theme => 'twitter-bootstrap-3', :pagination_class => "pagination-sm" %>
<br>

<!-- 使用者登入才能發文 -->
<% if current_user %>
  <%= link_to "New Post", new_post_path, :class => "btn btn-success" %>
<% else %>
  <%= link_to "New Post", new_session_path(:user), :class => "btn btn-success" %>
<% end %>



